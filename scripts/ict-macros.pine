// This Pine Script code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// ICT Timed Macros. Last 10 and First 10 minutes of every hourly candle
//@version=6
indicator("ICT Macros by @jbondata", shorttitle="ICT Macros by @jbondata", overlay=false, max_bars_back=500)

// Inputs: toggle each hourly macro
macro_00 = input.bool(true, "00:00", group="Hourly Macros")
macro_01 = input.bool(true, "01:00", group="Hourly Macros")
macro_02 = input.bool(true, "02:00", group="Hourly Macros")
macro_03 = input.bool(true, "03:00", group="Hourly Macros")
macro_04 = input.bool(true, "04:00", group="Hourly Macros")
macro_05 = input.bool(true, "05:00", group="Hourly Macros")
macro_06 = input.bool(true, "06:00", group="Hourly Macros")
macro_07 = input.bool(true, "07:00", group="Hourly Macros")
macro_08 = input.bool(true, "08:00", group="Hourly Macros")
macro_09 = input.bool(true, "09:00", group="Hourly Macros")
macro_10 = input.bool(true, "10:00", group="Hourly Macros")
macro_11 = input.bool(true, "11:00", group="Hourly Macros")
macro_12 = input.bool(true, "12:00", group="Hourly Macros")
macro_13 = input.bool(true, "13:00", group="Hourly Macros")
macro_14 = input.bool(true, "14:00", group="Hourly Macros")
macro_15 = input.bool(true, "15:00", group="Hourly Macros")
macro_16 = input.bool(true, "16:00", group="Hourly Macros")
macro_17 = input.bool(true, "17:00", group="Hourly Macros")
macro_18 = input.bool(true, "18:00", group="Hourly Macros")
macro_19 = input.bool(true, "19:00", group="Hourly Macros")
macro_20 = input.bool(true, "20:00", group="Hourly Macros")
macro_21 = input.bool(true, "21:00", group="Hourly Macros")
macro_22 = input.bool(true, "22:00", group="Hourly Macros")
macro_23 = input.bool(true, "23:00", group="Hourly Macros")

// Display
accent = input.color(color.new(#2962FF, 0), "Accent color", group="Display")
alt_color = input.color(color.new(#787b86, 30), "Alternate color (e.g. odd hours)", group="Display")
reversal_color = input.color(color.new(#FF9800, 0), "Reversal macro color (02:50 to 03:10, 09:50 to 10:10, 13:50 to 14:10)", group="Display")
show_reversal = input.bool(true, "Highlight reversal macros", group="Display")
alternate = input.bool(false, "Alternate colors by hour", group="Display")
line_width = input.int(3, "Segment line width", minval=1, maxval=8, group="Display")

// Time: bar's hour and minute in chosen timezone
macro_tz = input.string("America/New_York", "Macro timezone (e.g. America/New_York)", options=["America/New_York", "America/Chicago", "America/Los_Angeles", "UTC", "Europe/London", "Asia/Tokyo"], group="Display")
h = hour(time, macro_tz)
m = minute(time, macro_tz)

// Macro for "H:00" = last 10 min of (H-1) + first 10 min of H
in_macro_00 = (h == 23 and m >= 50) or (h == 0 and m < 10)
in_macro_01 = (h == 0 and m >= 50) or (h == 1 and m < 10)
in_macro_02 = (h == 1 and m >= 50) or (h == 2 and m < 10)
in_macro_03 = (h == 2 and m >= 50) or (h == 3 and m < 10)
in_macro_04 = (h == 3 and m >= 50) or (h == 4 and m < 10)
in_macro_05 = (h == 4 and m >= 50) or (h == 5 and m < 10)
in_macro_06 = (h == 5 and m >= 50) or (h == 6 and m < 10)
in_macro_07 = (h == 6 and m >= 50) or (h == 7 and m < 10)
in_macro_08 = (h == 7 and m >= 50) or (h == 8 and m < 10)
in_macro_09 = (h == 8 and m >= 50) or (h == 9 and m < 10)
in_macro_10 = (h == 9 and m >= 50) or (h == 10 and m < 10)
in_macro_11 = (h == 10 and m >= 50) or (h == 11 and m < 10)
in_macro_12 = (h == 11 and m >= 50) or (h == 12 and m < 10)
in_macro_13 = (h == 12 and m >= 50) or (h == 13 and m < 10)
in_macro_14 = (h == 13 and m >= 50) or (h == 14 and m < 10)
in_macro_15 = (h == 14 and m >= 50) or (h == 15 and m < 10)
in_macro_16 = (h == 15 and m >= 50) or (h == 16 and m < 10)
in_macro_17 = (h == 16 and m >= 50) or (h == 17 and m < 10)
in_macro_18 = (h == 17 and m >= 50) or (h == 18 and m < 10)
in_macro_19 = (h == 18 and m >= 50) or (h == 19 and m < 10)
in_macro_20 = (h == 19 and m >= 50) or (h == 20 and m < 10)
in_macro_21 = (h == 20 and m >= 50) or (h == 21 and m < 10)
in_macro_22 = (h == 21 and m >= 50) or (h == 22 and m < 10)
in_macro_23 = (h == 22 and m >= 50) or (h == 23 and m < 10)

// Apply toggles
active_00 = in_macro_00 and macro_00
active_01 = in_macro_01 and macro_01
active_02 = in_macro_02 and macro_02
active_03 = in_macro_03 and macro_03
active_04 = in_macro_04 and macro_04
active_05 = in_macro_05 and macro_05
active_06 = in_macro_06 and macro_06
active_07 = in_macro_07 and macro_07
active_08 = in_macro_08 and macro_08
active_09 = in_macro_09 and macro_09
active_10 = in_macro_10 and macro_10
active_11 = in_macro_11 and macro_11
active_12 = in_macro_12 and macro_12
active_13 = in_macro_13 and macro_13
active_14 = in_macro_14 and macro_14
active_15 = in_macro_15 and macro_15
active_16 = in_macro_16 and macro_16
active_17 = in_macro_17 and macro_17
active_18 = in_macro_18 and macro_18
active_19 = in_macro_19 and macro_19
active_20 = in_macro_20 and macro_20
active_21 = in_macro_21 and macro_21
active_22 = in_macro_22 and macro_22
active_23 = in_macro_23 and macro_23

in_any_macro = active_00 or active_01 or active_02 or active_03 or active_04 or active_05 or active_06 or active_07 or active_08 or active_09 or active_10 or active_11 or active_12 or active_13 or active_14 or active_15 or active_16 or active_17 or active_18 or active_19 or active_20 or active_21 or active_22 or active_23

// Hour of current macro (for alternating color)
macro_hour = m >= 50 ? (h + 1) % 24 : h
in_reversal_macro = active_03 or active_10 or active_14
segment_color = in_any_macro ? (show_reversal and in_reversal_macro ? reversal_color : (alternate and (macro_hour % 2 == 1) ? alt_color : accent)) : accent

// Pane: horizontal lines
plot(in_any_macro ? 1.0 : na, color=segment_color, style=plot.style_linebr, linewidth=line_width, title="Macro")