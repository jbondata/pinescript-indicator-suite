// This Pine Script code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// jbondata
//@version=6
indicator("Fractals by @jbondata", overlay = true, max_boxes_count = 500)
// Inputs
int leftBars = input.int(2, "Left bars", minval = 1, maxval = 10, group = "Fractal", tooltip = "Bars to the left of center for fractal detection (total length = 2*N+1).")
color colorHigh = input.color(color.red, "Fractal high color", group = "Style")
color colorLow = input.color(color.green, "Fractal low color", group = "Style")
bool asTriangles = input.bool(true, "Use triangles", group = "Style", tooltip = "Triangles when on; circles when off.")
// Fractal logic (center bar is highest high / lowest low in the window)
// Confirmed leftBars bars after the center so we have right-side bars.
float highestInRange = ta.highest(high, leftBars * 2 + 1)
float lowestInRange = ta.lowest(low, leftBars * 2 + 1)
bool isFractalHigh = (high[leftBars] == highestInRange) and (high[leftBars] > high[leftBars - 1]) and (high[leftBars] > high[leftBars + 1])
bool isFractalLow = (low[leftBars] == lowestInRange) and (low[leftBars] < low[leftBars - 1]) and (low[leftBars] < low[leftBars + 1])
// Draw shapes at the bar where the fractal formed (offset so shape sits on center bar)
shapeHigh = asTriangles ? shape.triangledown : shape.circle
shapeLow = asTriangles ? shape.triangleup : shape.circle
plotshape(isFractalHigh, "Fractal high", shapeHigh, location.abovebar, colorHigh, size = size.auto, offset = -leftBars)
plotshape(isFractalLow, "Fractal low", shapeLow, location.belowbar, colorLow, size = size.auto, offset = -leftBars)